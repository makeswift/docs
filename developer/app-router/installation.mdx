---
title: Installation
---

import CatchAllExample from "/snippets/app-router/catch-all.mdx"
import ProvidersExample from "/snippets/app-router/providers.mdx"
import LayoutExample from "/snippets/app-router/layout.mdx"
import ApiHandlerExample from "/snippets/app-router/api-handler.mdx"
import RuntimeExample from "/snippets/reference/runtime.mdx"
import ClientExample from "/snippets/reference/client.mdx"
import NextConfigExample from "/snippets/reference/next-config.mdx"

The fastest way to get started with Makeswift on a new Next.js project is to follow the
[quickstart](/developer/quickstart) guide. If you have an existing Next.js application
or want to set things up yourself, continue with the rest of this guide.

## System requirements

- [Node.js 18.17](https://nodejs.org/en) or a later version.
- macOS, Windows (including WSL), and Linux are supported.

## Geting started

<Steps>
  <Step title="Open your Next.js project">
    First, open your Next.js project. If you don't already have one, head over to
    the [Next.js](https://nextjs.org/docs/getting-started/installation)
    documentation to get one set up. If you do have one, please verify you are
    using [Next.js 13.4](https://nextjs.org/blog/next-13-4) or a later version that is using [App Router](https://nextjs.org/docs/getting-started/installation).

    <Info>
      If you are not using App Router, here's how to [incrementally adopt](https://nextjs.org/docs/app/building-your-application/upgrading/app-router-migration) it.
    </Info>

  </Step>
  <Step title="Install dependencies">
  Install the `@makeswift/runtime` package. This package contains all of the necessary
  code to integrate Makeswift into your Next.js app.

```bash
npm install @makeswift/runtime
```

  </Step>
  <Step title="Add API key to environment variables">
  
Requesting data through the `Makeswift` client requires a site API key from Makeswift. In the Makeswift builder, go to **Settings > Host** and copy the API key for the site.

<Frame>
  <img src="/images/site-api-key.gif" alt="How to get the site API key" />
</Frame>

Once the API key is in your clipboard, open your [`.env.local`](https://nextjs.org/docs/pages/building-your-application/configuring/environment-variables) file and paste the snippet below.

```sh
MAKESWIFT_SITE_API_KEY=paste-your-api-key-here
```

  </Step>
  <Step title="Add Makeswift runtime and client">
  
Create files for the Makeswift [runtime](/developer/reference/runtime/constructor) and [client](/developer/reference/client/constructor).

<CodeGroup>
  <RuntimeExample />
  <ClientExample />
</CodeGroup>

</Step>
  <Step title="Add the Makeswift API handler">
  
Similar to [NextAuth.js](https://next-auth.js.org/), Makeswift uses an API handler to communicate with your Next.js app. Create the file `app/api/makeswift/[...makeswift]/route.ts`.

<Info>
  It is important this file has that exact name and path. The extension can be
  `.js` or `.ts`.
</Info>

<ApiHandlerExample />

This API route adds support for
[Draft Mode](https://nextjs.org/docs/app/building-your-application/configuring/draft-mode),
[on-demand revalidation](https://nextjs.org/docs/pages/building-your-application/data-fetching/incremental-static-regeneration#on-demand-revalidation),
and other features that make Makeswift work seamlessly with your Next.js app.

  </Step>
  <Step title="Add the Next.js plugin">
  
Next.js plugins are configured in the project's next.config.js file by wrapping `nextConfig`. The Makeswift Next.js plugin whitelists Makeswift image domains and sets up rewrites to enable draft mode in the Makeswift builder.

<NextConfigExample />

  </Step>
  <Step title="Register components with Makeswift">
  
Create a file for registered components called `makeswift/components.tsx`. In this example, only one component is registered. However, as you register more components, we recommend creating separate files for each component and rolling up the imports in the `makeswift/components.ts` file. Learn more about [registering components](/developer/reference/runtime/register-component).

```tsx makeswift/components.tsx
import { ReactRuntime } from "@makeswift/runtime/react"
import { Style } from "@makeswift/runtime/controls"

function HelloWorld(props) {
  return <p {...props}>Hello, world!</p>
}

ReactRuntime.registerComponent(HelloWorld, {
  type: "hello-world",
  label: "Hello, world!",
  props: {
    className: Style(),
  },
})
```

  </Step>
  <Step title="Create Makeswift provider component">
    Create a client component for the Makeswift providers.

    <ProvidersExample />

    An important Note with this file is that you need to import the components registered in `makeswift/components.tsx`.

  </Step>
  <Step title="Update the root layout">
    In your root layout, wrap your app with the `MakeswiftProvider` component created in the last step, import the registered components, and add the `DraftModeScript` to the `head`. 
    This script enables [Draft Mode](https://nextjs.org/docs/app/building-your-application/configuring/draft-mode) when inside the Makeswift builder.

    <LayoutExample />

  </Step>
  <Step title="Add a route for Makeswift pages">
  
Create an [optional catch-all route](https://nextjs.org/docs/app/building-your-application/routing/dynamic-routes#optional-catch-all-segments) named `[[...path]]`. 
This catch-all route will fetch page data from `Makeswift` and pass it to be rendered in the `Page` component.

<CatchAllExample />

  </Step>
  
  <Step title="Start the local dev server">
  
Run the local development script. This will start the Next.js app at `http://localhost:3000`.

```bash
npm run dev
```

If port `3000` is already in use, Next.js will try port `3001`, then `3002`, and so forth until it finds an
unused port.

<Note>Take note of this port for the next step.</Note>

  </Step>
  <Step title="Add your app's URL to Makeswift">
  
Finally, open the Makeswift builder, navigate to **Settings > Host**, and add your app's URL. If you haven't changed anything in the example and the server is running on port `3000`, the app's URL should be
`http://localhost:3000`.

<Frame>
  <img src="/images/host-url.gif" alt="How to update the host url" />
</Frame>

When you're ready to deploy, set up a separate site and use your deployment URL
instead of `http://localhost:3000`. You can keep this site for local development.

  </Step>
  <Step title="Start building">
  
Great job! You should be able to create a page in Makeswift and start dropping in registered
components from the left toolbar.

<Frame>
  <img src="/images/registered-components.png" alt="Registered components" />
</Frame>

</Step>
</Steps>
